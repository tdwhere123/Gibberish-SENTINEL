# 开发任务清单

> **《终端对话》完整开发任务 - 按优先级排序**

---

## 📊 项目概览

| 项目信息 | 内容 |
|---------|------|
| 项目名称 | 终端对话 (Terminal Dialogue) |
| 开发周期 | 预计 3-5 天 |
| 技术栈 | HTML + CSS + JavaScript + AI API |
| 难度 | 中等 |
| 状态 | 🔴 未开始 |

---

## 🎯 开发阶段

### 阶段1: 核心框架搭建 ⭐⭐⭐
**目标**: 建立基础运行环境和游戏循环

### 阶段2: AI集成与对话系统 ⭐⭐⭐
**目标**: 实现与AI的交互和防注入机制

### 阶段3: UI美化与特效 ⭐⭐
**目标**: 完成赛博朋克终端视觉效果

### 阶段4: 游戏逻辑完善 ⭐⭐
**目标**: 实现数值系统和结局生成

### 阶段5: 测试与优化 ⭐
**目标**: 修复bug，优化体验

---

## 📝 详细任务列表

### 阶段1: 核心框架搭建

#### 1.1 项目结构创建
- [ ] **创建文件夹结构**
  ```
  terminal-adventure-game/
  ├── index.html
  ├── css/
  │   └── terminal.css
  ├── js/
  │   ├── config.js
  │   ├── main.js
  │   ├── game-state.js
  │   ├── ai-handler.js
  │   ├── input-sanitizer.js
  │   ├── commands.js
  │   ├── ui.js
  │   └── utils.js
  └── assets/
      └── fonts/
  ```
  - 估计时间: 5分钟
  - 优先级: 🔴 最高

#### 1.2 HTML基础结构
- [ ] **创建 index.html**
  - 基础HTML5模板
  - 终端容器div
  - 输入框元素
  - 状态栏容器
  - 引入CSS和JS文件
  - 估计时间: 15分钟
  - 优先级: 🔴 最高

- [ ] **测试HTML基础渲染**
  - 用浏览器打开确认结构正确
  - 估计时间: 5分钟

#### 1.3 JavaScript模块设置
- [ ] **创建 config.js**
  - 定义API配置（URL、密钥占位符、模型名）
  - 定义游戏常量（时长、最大轮次等）
  - 导出配置对象
  - 估计时间: 10分钟
  - 优先级: 🔴 最高

- [ ] **创建 game-state.js**
  - 实现GameState类
  - 构造函数初始化所有状态
  - 实现基础方法：
    - `updateTime()` - 更新剩余时间
    - `addDialogue()` - 记录对话
    - `checkEndCondition()` - 检查结局触发
    - `analyzeInput()` - 分析输入调整数值
  - 导出类
  - 估计时间: 45分钟
  - 优先级: 🔴 最高

- [ ] **创建 utils.js**
  - 实现工具函数：
    - `delay(ms)` - 延迟函数
    - `clamp(value, min, max)` - 数值限制
    - `formatTime(seconds)` - 格式化时间显示
    - `getCurrentSystemTime()` - 获取系统时间
  - 估计时间: 20分钟
  - 优先级: 🟡 中等

- [ ] **创建 main.js 框架**
  - 导入所有必要模块
  - 定义全局变量（gameState、inputElement等）
  - 实现 `init()` 函数框架
  - 实现 `startGameLoop()` 框架
  - 添加DOMContentLoaded监听器
  - 估计时间: 30分钟
  - 优先级: 🔴 最高

#### 1.4 基础交互实现
- [ ] **实现用户输入监听**
  - 在 main.js 中添加输入框事件监听
  - 处理Enter键提交
  - 清空输入框
  - 显示用户输入到终端
  - 估计时间: 20分钟
  - 优先级: 🔴 最高

- [ ] **实现基础UI渲染 (ui.js)**
  - `appendMessage(type, text)` - 添加消息到终端
  - `clearTerminal()` - 清空终端
  - `updateStatusBar(gameState)` - 更新状态栏
  - 估计时间: 30分钟
  - 优先级: 🔴 最高

- [ ] **测试基础交互**
  - 输入文字能显示在终端
  - 状态栏能正常更新
  - 估计时间: 10分钟

---

### 阶段2: AI集成与对话系统

#### 2.1 输入过滤系统
- [ ] **创建 input-sanitizer.js**
  - 实现 `sanitizeInput(input)` 函数
  - 过滤所有危险模式：
    - `[system]`, `[assistant]`, `[user]`
    - `<|...|>` 特殊token
    - `### system`, `Human:`, `Assistant:` 等
  - 长度限制（500字符）
  - 导出函数
  - 估计时间: 30分钟
  - 优先级: 🔴 最高

- [ ] **测试输入过滤**
  - 测试各种注入尝试
  - 确认都被正确过滤
  - 估计时间: 15分钟

#### 2.2 AI处理模块
- [ ] **创建 ai-handler.js 基础**
  - 导入config和sanitizer
  - 定义SYSTEM_PROMPT（完整的系统提示词）
  - 估计时间: 20分钟
  - 优先级: 🔴 最高

- [ ] **实现 buildRequest() 函数**
  - 接收用户输入和gameState
  - 过滤输入
  - 构建符合API格式的请求对象
  - 包含：
    - system消息（SYSTEM_PROMPT）
    - user消息（包含游戏状态和过滤后的输入）
  - 估计时间: 30分钟
  - 优先级: 🔴 最高

- [ ] **实现 getAIResponse() 函数**
  - 异步函数
  - 调用buildRequest构建请求
  - 使用fetch调用API
  - 处理响应和错误
  - 返回AI回复文本
  - 估计时间: 40分钟
  - 优先级: 🔴 最高

- [ ] **测试AI调用**
  - 填入真实API密钥
  - 测试简单对话
  - 确认AI保持SENTINEL身份
  - 估计时间: 20分钟

#### 2.3 对话流程整合
- [ ] **在 main.js 中实现 processInput() 函数**
  - 轮次计数+1
  - 检查是否是特殊指令（后续实现）
  - 显示"思考中"提示
  - 调用getAIResponse
  - 显示AI回复
  - 记录对话到gameState
  - 分析输入更新数值
  - 更新UI状态栏
  - 估计时间: 40分钟
  - 优先级: 🔴 最高

- [ ] **测试完整对话流程**
  - 输入 → AI回复 → 数值更新
  - 确认流程完整
  - 估计时间: 15分钟

#### 2.4 开场序列
- [ ] **定义OPENING_SEQUENCE数据**
  - 在 main.js 或单独文件中
  - 包含所有开场消息和延迟
  - 估计时间: 15分钟
  - 优先级: 🟡 中等

- [ ] **实现 playOpeningSequence() 函数**
  - 逐条播放开场消息
  - 使用延迟制造节奏感
  - 估计时间: 25分钟
  - 优先级: 🟡 中等

- [ ] **在 init() 中调用开场序列**
  - 游戏启动时播放开场
  - 估计时间: 5分钟

---

### 阶段3: UI美化与特效

#### 3.1 基础样式
- [ ] **创建 terminal.css 基础结构**
  - CSS变量定义（颜色、字体等）
  - body基础样式
  - 终端容器样式
  - 估计时间: 20分钟
  - 优先级: 🟡 中等

- [ ] **字体设置**
  - 下载等宽字体（VT323或类似）
  - 放入 assets/fonts/
  - 在CSS中引入
  - 应用到终端
  - 估计时间: 15分钟
  - 优先级: 🟡 中等

- [ ] **颜色主题实现**
  - 定义琥珀/绿色主题变量
  - 应用到不同类型消息
  - 测试对比度和可读性
  - 估计时间: 25分钟
  - 优先级: 🟡 中等

#### 3.2 终端特效
- [ ] **光标闪烁效果**
  - CSS动画实现
  - 添加到输入框
  - 估计时间: 15分钟
  - 优先级: 🟡 中等

- [ ] **CRT扫描线效果**
  - 使用CSS伪元素
  - linear-gradient制作扫描线
  - 可选：添加轻微动画
  - 估计时间: 30分钟
  - 优先级: 🟢 低

- [ ] **文字辉光效果**
  - text-shadow制作辉光
  - 应用到SENTINEL消息
  - 估计时间: 10分钟
  - 优先级: 🟢 低

- [ ] **打字机效果**
  - 在 ui.js 中实现 `typewriterEffect()` 函数
  - 逐字显示文本
  - 可调速度
  - 完成后回调
  - 估计时间: 35分钟
  - 优先级: 🟡 中等

#### 3.3 UI组件完善
- [ ] **状态栏美化**
  - 设计美观的状态栏布局
  - 添加图标或符号
  - 数值变化动画（可选）
  - 估计时间: 30分钟
  - 优先级: 🟡 中等

- [ ] **消息区域滚动**
  - 实现自动滚动到底部
  - 添加滚动条样式（或隐藏）
  - 估计时间: 20分钟
  - 优先级: 🟡 中等

- [ ] **思考提示动画**
  - 实现"SENTINEL正在处理..."提示
  - 添加动画效果（点点点动画）
  - 在 ui.js 中实现显示/隐藏函数
  - 估计时间: 20分钟
  - 优先级: 🟡 中等

#### 3.4 响应式设计
- [ ] **移动端适配**（可选）
  - 媒体查询调整字体大小
  - 调整布局以适应小屏幕
  - 估计时间: 45分钟
  - 优先级: 🟢 低

---

### 阶段4: 游戏逻辑完善

#### 4.1 特殊指令系统
- [ ] **创建 commands.js**
  - 定义COMMANDS对象（所有指令配置）
  - 实现 `handleCommand(input, gameState)` 函数
  - 检查输入是否匹配指令
  - 执行指令逻辑
  - 应用效果到gameState
  - 返回响应文本
  - 估计时间: 60分钟
  - 优先级: 🟡 中等

- [ ] **整合指令到主循环**
  - 在 processInput() 中优先检查指令
  - 如果是指令，执行并跳过AI调用
  - 估计时间: 15分钟

- [ ] **测试所有指令**
  - 逐个测试每条指令
  - 确认效果正确应用
  - 估计时间: 30分钟

#### 4.2 数值系统完善
- [ ] **关键词分析实现**
  - 在 game-state.js 中完善 `analyzeInput()`
  - 定义KEYWORD_EFFECTS常量
  - 遍历关键词并应用效果
  - 估计时间: 40分钟
  - 优先级: 🟡 中等

- [ ] **数值限制和平衡**
  - 确保suspicion和trust在0-100范围
  - 调整关键词效果数值
  - 测试平衡性
  - 估计时间: 30分钟
  - 优先级: 🟡 中等

#### 4.3 时间管理系统
- [ ] **时间倒计时实现**
  - 在 startGameLoop() 中添加定时器
  - 每秒更新 gameState.timeLeft
  - 更新UI显示
  - 估计时间: 20分钟
  - 优先级: 🔴 最高

- [ ] **时间警告系统**
  - 定义TIME_WARNINGS数据
  - 实现 `checkTimeWarnings()` 函数
  - 在主循环中检查并显示警告
  - 估计时间: 30分钟
  - 优先级: 🟡 中等

#### 4.4 结局系统
- [ ] **结局触发检查**
  - 完善 gameState.checkEndCondition()
  - 检查所有触发条件
  - 返回结局类型
  - 估计时间: 20分钟
  - 优先级: 🔴 最高

- [ ] **结局生成函数**
  - 在 ai-handler.js 中实现 `generateEnding()`
  - 构建结局评估的特殊prompt
  - 包含完整对话历史
  - 调用AI生成结局文本
  - 估计时间: 40分钟
  - 优先级: 🔴 最高

- [ ] **结局展示界面**
  - 在 ui.js 中实现 `showEndScreen()`
  - 显示结局文本
  - 显示统计数据（信任度、怀疑度、轮次等）
  - 添加"重新开始"按钮（可选）
  - 估计时间: 40分钟
  - 优先级: 🟡 中等

- [ ] **实现 endGame() 函数**
  - 在 main.js 中实现
  - 禁用输入
  - 调用generateEnding
  - 显示结局
  - 估计时间: 25分钟
  - 优先级: 🔴 最高

- [ ] **测试所有结局路径**
  - 测试时间耗尽结局
  - 测试高怀疑度结局
  - 测试高信任度结局
  - 测试自然结束结局
  - 估计时间: 45分钟

#### 4.5 边缘情况处理
- [ ] **网络错误处理**
  - 在 ai-handler.js 中添加错误捕获
  - 显示友好错误信息
  - 估计时间: 25分钟
  - 优先级: 🟡 中等

- [ ] **空输入处理**
  - 忽略空白输入
  - 估计时间: 5分钟

- [ ] **快速连续输入限制**
  - 防止用户在AI回复前重复输入
  - 使用输入框disabled状态
  - 估计时间: 15分钟
  - 优先级: 🟡 中等

---

### 阶段5: 测试与优化

#### 5.1 功能测试
- [ ] **完整流程测试**
  - 从启动到结局完整体验
  - 记录所有bug
  - 估计时间: 60分钟
  - 优先级: 🔴 最高

- [ ] **边界情况测试**
  - 测试极端输入（超长、特殊字符）
  - 测试极端数值（0、100）
  - 测试快速操作
  - 估计时间: 45分钟
  - 优先级: 🟡 中等

- [ ] **跨浏览器测试**
  - Chrome
  - Firefox
  - Safari（如可能）
  - Edge
  - 估计时间: 30分钟
  - 优先级: 🟡 中等

#### 5.2 AI质量测试
- [ ] **身份保持测试**
  - 尝试各种方式打破AI身份
  - 确认AI始终保持SENTINEL角色
  - 估计时间: 45分钟
  - 优先级: 🔴 最高

- [ ] **对话质量测试**
  - 多次完整游玩
  - 评估AI回复质量
  - 调整System Prompt（如需要）
  - 估计时间: 90分钟
  - 优先级: 🔴 最高

- [ ] **结局质量测试**
  - 测试不同路线的结局生成
  - 确保结局有深度和余韵
  - 估计时间: 60分钟
  - 优先级: 🔴 最高

#### 5.3 性能优化
- [ ] **加载速度优化**
  - 压缩CSS和JS（可选）
  - 优化字体加载
  - 估计时间: 30分钟
  - 优先级: 🟢 低

- [ ] **动画性能检查**
  - 确保特效不卡顿
  - 必要时简化动画
  - 估计时间: 20分钟
  - 优先级: 🟢 低

#### 5.4 打磨与调整
- [ ] **文案润色**
  - 检查所有系统消息
  - 统一术语和风格
  - 估计时间: 30分钟
  - 优先级: 🟡 中等

- [ ] **数值平衡调整**
  - 根据测试调整初始值
  - 调整关键词效果强度
  - 确保15分钟的游戏时长合理
  - 估计时间: 45分钟
  - 优先级: 🟡 中等

- [ ] **最终审查**
  - 完整体验游戏
  - 确认达到预期效果
  - 估计时间: 60分钟
  - 优先级: 🔴 最高

---

## 📦 部署任务

### 6.1 准备部署
- [ ] **填入真实API密钥**
  - 在 config.js 中填入实际密钥
  - 估计时间: 2分钟

- [ ] **测试部署版本**
  - 在服务器环境测试
  - 确认API调用正常
  - 估计时间: 20分钟

### 6.2 博客嵌入
- [ ] **创建嵌入代码**
  - 编写iframe代码
  - 或创建自定义HTML嵌入代码
  - 估计时间: 15分钟

- [ ] **博客测试**
  - 在博客中嵌入游戏
  - 测试在博客环境中的运行
  - 估计时间: 20分钟

---

## 📈 时间估算总结

| 阶段 | 估计时间 |
|-----|---------|
| 阶段1: 核心框架 | 3-4小时 |
| 阶段2: AI集成 | 4-5小时 |
| 阶段3: UI美化 | 4-5小时 |
| 阶段4: 游戏逻辑 | 5-7小时 |
| 阶段5: 测试优化 | 6-8小时 |
| 部署 | 1小时 |
| **总计** | **23-30小时** |

实际开发时间可能因经验和问题而有所不同。

---

## 🎯 里程碑

### 里程碑1: 可运行原型
- [ ] 能启动游戏
- [ ] 能输入文字并显示
- [ ] 能调用AI并获得回复
- 目标时间: 第1天结束

### 里程碑2: 核心功能完整
- [ ] 完整对话流程
- [ ] 数值系统工作
- [ ] 特殊指令可用
- [ ] 能触发结局
- 目标时间: 第2-3天结束

### 里程碑3: 视觉完成
- [ ] 终端美化完成
- [ ] 特效添加完毕
- [ ] UI体验流畅
- 目标时间: 第3-4天结束

### 里程碑4: 发布就绪
- [ ] 所有功能测试通过
- [ ] AI质量达标
- [ ] 可嵌入博客
- 目标时间: 第5天结束

---

## 🐛 已知问题列表

（在开发过程中记录发现的问题）

| ID | 问题描述 | 优先级 | 状态 |
|----|---------|-------|------|
| - | - | - | - |

---

## 💡 可选增强功能

（如果时间允许）

- [ ] **音效系统**
  - 键盘敲击声
  - 环境白噪音
  - CRT电流声
  - 估计时间: 2小时

- [ ] **多结局收集**
  - 本地存储记录已触发结局
  - 显示结局收集进度
  - 估计时间: 1.5小时

- [ ] **数据可视化**
  - 结局时显示数值变化曲线图
  - 估计时间: 2小时

- [ ] **难度选择**
  - 简单模式（AI更友善）
  - 困难模式（AI更怀疑）
  - 估计时间: 1小时

- [ ] **隐藏成就系统**
  - 触发特定对话获得成就
  - 估计时间: 2小时

---

## 📚 开发资源

### 需要的资源
- [ ] 等宽字体文件（VT323或类似）
- [ ] API文档（云雾API使用说明）
- [ ] 参考：赛博朋克视觉设计

### 有用的工具
- 本地服务器：Live Server (VS Code插件)
- API测试：Postman 或 curl
- 浏览器：Chrome DevTools

---

## ✅ 完成标准

游戏达到以下标准即可视为完成：

1. **功能完整**
   - ✅ 能完整游玩15分钟
   - ✅ AI保持SENTINEL身份
   - ✅ 数值系统正常工作
   - ✅ 能触发并显示结局

2. **体验良好**
   - ✅ UI符合赛博朋克美学
   - ✅ 交互流畅无明显延迟
   - ✅ 没有破坏沉浸感的bug

3. **哲学深度**
   - ✅ 对话有思考价值
   - ✅ 结局引发反思
   - ✅ 符合世界观设定

4. **技术稳定**
   - ✅ 无严重bug
   - ✅ API调用稳定
   - ✅ 跨浏览器兼容

---

## 📝 开发日志

（在开发过程中记录进展和决策）

### 日期: ____
- 完成任务:
- 遇到问题:
- 解决方案:
- 明天计划:

---

**文档创建日期**: 2024
**状态**: 🔴 待开始
**下一步**: 阶段1.1 - 创建项目结构

> 提示：建议按照任务顺序逐步完成，每完成一个阶段都要进行测试。
> 遇到问题及时记录在"已知问题列表"中。
> 祝开发顺利！🚀
