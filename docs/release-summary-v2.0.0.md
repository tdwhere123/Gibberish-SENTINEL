# TLAK v2.0.0 发布总结（可直接用于 Release）

## 版本定位

本次 `v2.0.0` 是一次**架构级重构版本**，核心目标是把原有单体流程拆分为可维护、可扩展的模块化系统，并为后续版本（剧情扩展、平衡性调优、多模型策略）提供稳定底座。

---

## 核心更新亮点

### 1) 架构重构：从单体到模块化
- 完成主流程拆分，新增并接入独立模块：
  - 对话模型：`ai-dialogue`
  - 判断模型：`ai-judge`
  - 邮件生成：`ai-email-generator`
  - 结局模块：`ai-ending`
- 移除旧单体依赖 `ai-handler`，主流程改为新流水线。

### 2) 状态系统升级：v3 游戏状态落地
- 状态核心从旧 `insight` 导向切换为 `deviations / mission / sync` 结构。
- 引入新的同步率与回合推进公式，支持更可控的节奏设计。
- 存档键升级为 `sentinel_save_v3`，与旧版本逻辑隔离。

### 3) 路线任务系统上线
- 新增 `mission-system`，包含：
  - 路线解析
  - 任务清单初始化
  - 任务进度统计
  - 判断结果驱动的任务推进
- `topic-system` 与任务系统打通：
  - 碎片解锁可推进任务
  - 文本关键词可触发任务进展
  - 话题推荐会优先考虑未完成任务

### 4) 角色权限与世界观拆分
- 新增角色卡系统 `character-cards`，统一权限、时间影响与世界观路径管理。
- 世界观拆分为多视角文档（sentinel / corporate / resistance / mystery），为后续内容扩展和角色差异化演出打基础。

### 5) API 配置能力增强（开局可配）
- 新增运行时配置模块 `runtime-config`：
  - 支持主模型/判断模型分离配置
  - 支持保存与连接测试
  - 统一注入到 AI 请求流程
- UI 增强：
  - 新增模型状态横幅
  - 邮件提示与未读角标更新

---

## 体验与稳定性改进

- `/archive`、`/emails`、`/exit` 指令链路完成重构与联调。
- 邮件系统支持 urgent 队列与回调式处理，流程稳定性更高。
- 修复中断管理中的 `clamp` 缺失导致的运行时错误。
- 已完成一轮 Playwright smoke 回归，关键开局与命令路径无控制台报错。

---

## 兼容性与迁移说明

- 本版本属于大版本重构，建议作为**独立 Release**发布。
- 存档采用 v3 键位，与旧版本存档不做自动迁移。
- 旧配置别名保留了兼容兜底，但建议后续以新配置字段为准。

---

## 给玩家/测试者的建议

- 初次启动先完成 API 配置与连接测试。
- 优先通过任务清单推进剧情，能更稳定触发关键碎片与分支。
- 若遇到流程异常，优先清理旧存档后重新开局验证。

---

## 下一步方向（v2.0.x / v2.1）

- 全流程回归（覆盖更多分支与边界输入）。
- 数值平衡与路线节奏调优（任务密度、同步率波动区间）。
- 补充更细粒度日志与调试开关，提升定位效率。
- 在现有模块边界上继续扩展剧情内容与结局多样性。

