# TLAK v2.1.0 发布总结

## 版本定位

`v2.1.0` 是基于 v2.0 架构重构之上的**体验强化与稳健性治理版本**。核心目标是解决邮件系统频率失控、碎片触发逻辑不准确、对话风格差异不足等问题，同时提升叙事文本质量与角色视觉表现力。

---

## 核心更新亮点

### 1) 碎片触发逻辑修正 (T1)
- 数据碎片解锁仅由**玩家输入**触发，AI 回复中的关键词不再误触发解锁。
- 解锁提示延迟到**下一轮输入**时显示，避免打断当前对话节奏。

### 2) 邮件内容叙事化改造 (T2)
- 邮件正文完全去除偏差值、数值元数据等机械信息。
- 统一为角色化叙事语气（公司正式/抵抗紧迫/神秘留白）。
- 禁止生成 Markdown 格式，确保终端风格一致。

### 3) 触发频率治理 (T3)
- 角色邮件引入冷却机制：corporate 6 轮 / resistance 5 轮 / mystery 8 轮。
- 同一回合去重保护，避免多个系统并行触发导致邮件轰炸。
- 打断概率曲线整体下调，每局邮件总量控制在合理区间。

### 4) 邮件交互统一化 (T4)
- 紧急邮件不再强制切屏打断对话，改为**统一入箱 + 提示通知**。
- `/emails` 命令打开时自动结算待处理的紧急邮件回调（时间影响等）。
- 新增未读角标与 toast 提示，确保玩家不漏看关键邮件。

### 5) 事件因果链绑定 (T5)
- 玩家输入敏感关键词后，对应角色邮件**延迟 1-2 回合**触发。
- 建立可感知的"因-果"叙事链：说了什么 → 引来了谁的关注。
- 高同步率下跨路线触发神秘人信号，增加路线交叉感。

### 6) SENTINEL 回复风格差异化 (T6)
- 情绪识别后注入严格的风格约束（句长、修辞、词汇限制）。
- 四种情绪提供 few-shot 示例（agitated / breakthrough / collision / calm）。
- 最终守卫机制：生成文本若与情绪守卫冲突，要求模型重写。

### 7) 档案叙事文本增强 (T7)
- 重写五枚高优先级数据碎片文本：
  - `sentinel_fear`：从陈述式改为自省式追问
  - `ghost_code`：从定义式改为悬念叙事
  - `paradox`：从概念说明改为对位提问
  - `core_layer`：从情报摘要改为灰区密约暗示
  - `project_p0`：从历史记录改为决策悬念叙事
- 每枚碎片末尾增加隐性追问，引导玩家继续深入。

### 8) 角色视觉特效系统 (T8)
- 角色卡新增 `visualEffects` 配置，支持每角色多种特效类别。
- 新增 `triggerCharacterEffect` UI API，统一特效触发接口。
- CSS 新增 BEM 命名动画：surveillance / signal / spark / pulse 等。

---

## 技术改进

- `events-system.js` 完全重写，引入角色冷却状态管理与延迟调度队列。
- `runtime-config.js` 配置注入链路稳定运行（localStorage → window.__APP_CONFIG__ → 默认值）。
- 所有新增函数均添加 JSDoc 注释，修改函数标注 `// v2.1 update:`。
- 静态配置使用 `Object.freeze()` 保护。

---

## 已知问题

- **API 配置保存 Bug**：在 Test Connection 成功后点击保存按钮，`tested` 状态被强制覆盖为 `false`，导致保存后显示"未配置"。（将在 v2.2 中修复）
- 故事文本氛围和衔接仍有提升空间（v2.2 迭代重点）。
- 开局 AI 问候和角色卡深度不足，缺乏解谜/推理层次（v2.2 迭代重点）。

---

## 兼容性说明

- 存档键维持 `sentinel_save_v3`，与 v2.0 存档兼容。
- 邮件冷却状态新增 `emailTriggerState` 字段，旧存档会自动初始化默认值。

---

## 下一步方向（v2.2）

- 修复 API 配置保存 Bug。
- 融入解谜/推理游戏设计灵感，改进开局 AI 对白与角色卡深度。
- 任务系统从"清单"向"调查档案"模式演进。
- 开场邮件、系统消息、数据碎片全面叙事增强。
- 世界观文件扩展丰富。
